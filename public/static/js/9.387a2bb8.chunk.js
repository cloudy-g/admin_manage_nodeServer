(this.webpackJsonpadmin_manage=this.webpackJsonpadmin_manage||[]).push([[9],{555:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return q}));r(148);var n=r(147),a=(r(141),r(138)),c=(r(185),r(188)),s=(r(546),r(541)),i=(r(345),r(353)),l=(r(154),r(161)),u=r(131),o=r.n(u),j=(r(135),r(134)),b=r(173),p=r(198),O=r(142),d=(r(193),r(215)),f=r(133),m=r(0),x=r(6),h=r(544),v=r(545),y=r(158),g=r(263),w=r(342),k=r(82),I=r(386),S=r(5),F={labelCol:{xs:{span:4},sm:{span:2}},wrapperCol:{xs:{span:18},sm:{span:8}}},P={wrapperCol:{xs:{span:4,offset:0},sm:{span:3,offset:0}}},C=function(e,t){return!!t.find((function(t){return t.title===e.title}))};function q(e){var t=e.sumData,r=e.setSumData,u=e.setSource,q=d.a.useForm(),T=Object(f.a)(q,1)[0],D=Object(x.g)(),E=Object(x.i)().id,J=Object(m.useState)([]),N=Object(f.a)(J,2),R=N[0],U=N[1],_=Object(m.useState)(!1),A=Object(f.a)(_,2),B=A[0],V=A[1],z=Object(m.useState)(""),G=Object(f.a)(z,2),H=G[0],K=G[1],M=Object(m.useState)(""),Q=Object(f.a)(M,2),W=Q[0],X=Q[1],Y=Object(m.useState)([]),Z=Object(f.a)(Y,2),$=Z[0],ee=Z[1],te=Object(m.useState)(""),re=Object(f.a)(te,2),ne=re[0],ae=re[1],ce=null,se=-1;"add"!==E&&-1!==(se=t.findIndex((function(e){return e.pid==E})))&&(ce=t[se]);var ie=function(){var e=Object(O.a)(o.a.mark((function e(n){var a,c,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(n),a=null,!ce){e.next=26;break}return(c=Object(p.a)({},ce)).title=n.title,c.seller=n.seller,c.price=n.price,c.type=Object(b.a)(n.type),c.src=ne,e.prev=9,e.next=12,Object(g.b)(c);case 12:a=e.sent,e.next=18;break;case 15:e.prev=15,e.t0=e.catch(9),console.log(e.t0);case 18:return e.next=20,Object(g.a)();case 20:s=(s=e.sent).map((function(e){return e.key=e.pid,e})),u(s),r(s),e.next=39;break;case 26:if(!C(n,t)){e.next=30;break}return j.b.error("\u91cd\u590d\u6dfb\u52a0\u5546\u54c1\u540d\u79f0"),e.abrupt("return");case 30:return n.pid=Object(I.a)(),n.key=n.pid,n.price="\uffe5".concat(n.price),n.src=ne,e.next=36,Object(g.b)(n);case 36:a=e.sent,r([].concat(Object(b.a)(t),[n])),u([].concat(Object(b.a)(t),[n]));case 39:j.b.success(a),D.replace("/product");case 41:case"end":return e.stop()}}),e,null,[[9,15]])})));return function(t){return e.apply(this,arguments)}}(),le=Object(S.jsxs)("div",{children:[Object(S.jsx)(h.a,{}),Object(S.jsx)("div",{style:{marginTop:8},children:"Upload"})]}),ue=function(){var e=Object(O.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.url||t.preview){e.next=4;break}return e.next=3,L(t.originFileObj);case 3:t.preview=e.sent;case 4:K(t.url||t.preview),V(!0),X(t.name||t.url.substring(t.url.lastIndexOf("/")+1));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(m.useEffect)((function(){(function(){var e=Object(O.a)(o.a.mark((function e(){var t,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(w.a)();case 2:t=e.sent,r=Object(k.a)(t,[]),U(r);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()(),ce&&(T.setFieldsValue({title:ce.title,seller:ce.seller,price:ce.price,type:[ce.type]}),ce.src="/"===ce.src[0]?ce.src:"/"+ce.src,ee([{uid:-se,name:ce.title,status:"done",url:"http://localhost:5000"+ce.src}]))}),[]),Object(S.jsx)(n.a,{title:"",extra:Object(S.jsxs)("div",{className:"detail-title",children:[Object(S.jsx)(v.a,{}),Object(S.jsx)(y.a,{onClick:function(){D.goBack()},children:"\u8fd4\u56de\u5546\u54c1\u5217\u8868"})]}),children:Object(S.jsxs)(d.a,Object(p.a)(Object(p.a)({},F),{},{form:T,name:"confirm",onFinish:ie,scrollToFirstError:!0,children:[Object(S.jsx)(d.a.Item,{name:"title",label:"\u5546\u54c1\u540d\u79f0",rules:[{required:!0,message:"Please input your product name!"}],children:Object(S.jsx)(l.a,{})}),Object(S.jsx)(d.a.Item,{name:"seller",label:"\u5e97\u94fa\u540d\u79f0",rules:[{required:!0,message:"Please input your shop name!"}],children:Object(S.jsx)(l.a,{})}),Object(S.jsx)(d.a.Item,{name:"price",label:"\u5546\u54c1\u4ef7\u683c",rules:[{required:!0,message:"Please input your product price!"}],children:Object(S.jsx)(l.a,{})}),Object(S.jsx)(d.a.Item,{name:"type",label:"\u5546\u54c1\u5206\u7c7b",rules:[{required:!0,message:"Please select your habitual residence!"}],children:Object(S.jsx)(i.a,{options:R,placeholder:"\u9009\u62e9\u5546\u54c1\u5206\u7c7b"})}),Object(S.jsx)(d.a.Item,{label:"\u5546\u54c1\u56fe\u7247",name:"src",valuePropName:"fileList",children:Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)(s.a,{action:"http://localhost:5000/img/upload",name:"file",listType:"picture-card",fileList:$,onPreview:ue,onChange:function(e){var t=e.file,r=e.fileList;if(ee(r),t.response){var n=t.response.split("/");n.shift(),ae("/".concat(n.join("/")))}},children:$.length>=1?null:le}),Object(S.jsx)(c.a,{visible:B,title:W,footer:null,onCancel:function(){return V(!1)},children:Object(S.jsx)("img",{alt:"example",style:{width:"100%"},src:H})})]})}),Object(S.jsx)(d.a.Item,Object(p.a)(Object(p.a)({},P),{},{children:Object(S.jsx)(a.a,{type:"primary",htmlType:"submit",children:"\u786e\u8ba4\u63d0\u4ea4"})}))]}))})}function L(e){return new Promise((function(t,r){var n=new FileReader;n.readAsDataURL(e),n.onload=function(){return t(n.result)},n.onerror=function(e){return r(e)}}))}}}]);
//# sourceMappingURL=9.387a2bb8.chunk.js.map